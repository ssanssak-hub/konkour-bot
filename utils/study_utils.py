"""
Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ
"""
import random
from datetime import datetime
from typing import List, Dict, Any
from aiogram.types import InlineKeyboardButton, InlineKeyboardMarkup

def get_study_tips() -> str:
    """
    Ø¯Ø±ÛŒØ§ÙØª Ù†Ú©Ø§Øª Ù…Ø·Ø§Ù„Ø¹Ø§ØªÛŒ ØªØµØ§Ø¯ÙÛŒ
    """
    tips = [
        "ğŸ¯ **Ù†Ú©ØªÙ‡ Ø·Ù„Ø§ÛŒÛŒ**: Ù…Ø·Ø§Ù„Ø¹Ù‡ ÙØ¹Ø§Ù„ Ø¨Ù‡ØªØ± Ø§Ø² Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù…Ù†ÙØ¹Ù„ Ø§Ø³Øª! Ø³ÙˆØ§Ù„ Ø¨Ù¾Ø±Ø³ÛŒØ¯ Ùˆ Ø®Ù„Ø§ØµÙ‡ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯.",
        "â° **Ù…Ø¯ÛŒØ±ÛŒØª Ø²Ù…Ø§Ù†**: Ø§Ø² ØªÚ©Ù†ÛŒÚ© Ù¾ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ (Û²Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ Ù…Ø·Ø§Ù„Ø¹Ù‡ØŒ Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø§Ø³ØªØ±Ø§Ø­Øª).",
        "ğŸ“ **Ù…Ø±ÙˆØ± Ù‡ÙˆØ´Ù…Ù†Ø¯**: Ù…Ø·Ø§Ù„Ø¨ Ø±Ø§ Ø¯Ø± ÙÙˆØ§ØµÙ„ Ø²Ù…Ø§Ù†ÛŒ Ù…Ø´Ø®Øµ Ù…Ø±ÙˆØ± Ú©Ù†ÛŒØ¯ ØªØ§ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ø¨Ù„Ù†Ø¯Ù…Ø¯Øª Ø«Ø¨Øª Ø´ÙˆÙ†Ø¯.",
        "ğŸ’¡ **ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø¹Ù…ÛŒÙ‚**: Ø³Ø¹ÛŒ Ú©Ù†ÛŒØ¯ Ù…ÙØ§Ù‡ÛŒÙ… Ø±Ø§ Ø¨Ù‡ Ø²Ø¨Ø§Ù† Ø®ÙˆØ¯ØªØ§Ù† ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯.",
        "ğŸ“Š **Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ**: Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ Ùˆ Ø¨Ù‡ Ø¢Ù† Ù¾Ø§ÛŒØ¨Ù†Ø¯ Ø¨Ø§Ø´ÛŒØ¯.",
        "ğŸ”„ **ØªØ³Øª Ø²Ù†ÛŒ**: Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø± Ù…Ø¨Ø­Ø«ØŒ ØªØ³Øª Ø²Ù…Ø§Ù†Ø¯Ø§Ø± Ø¨Ø²Ù†ÛŒØ¯.",
        "ğŸ“ˆ **ØªØ­Ù„ÛŒÙ„ Ø¢Ø²Ù…ÙˆÙ†**: Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø± Ø¢Ø²Ù…ÙˆÙ†ØŒå¼±ç‚¹Ù‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ Ø¨Ø±Ø·Ø±Ù Ú©Ù†ÛŒØ¯.",
        "ğŸ§˜ **Ø³Ù„Ø§Ù…Øª Ø±ÙˆØ§Ù†**: Ø§Ø³ØªØ±Ø§Ø­Øª Ú©Ø§ÙÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ Ùˆ ÙˆØ±Ø²Ø´ Ø±Ø§ ÙØ±Ø§Ù…ÙˆØ´ Ù†Ú©Ù†ÛŒØ¯.",
        "ğŸ“š **Ù…Ù†Ø§Ø¨Ø¹ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯**: Ø§Ø² Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¹ØªØ¨Ø± Ùˆ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
        "ğŸª **ØªØ¹Ø§Ø¯Ù„**: Ø¨ÛŒÙ† Ù…Ø·Ø§Ù„Ø¹Ù‡ Ùˆ ØªÙØ±ÛŒØ­ ØªØ¹Ø§Ø¯Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†ÛŒØ¯."
    ]
    return random.choice(tips)

def get_motivational_quote() -> str:
    """
    Ø¯Ø±ÛŒØ§ÙØª Ø¬Ù…Ù„Ù‡ Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ ØªØµØ§Ø¯ÙÛŒ
    """
    quotes = [
        "ğŸ’ª **Ø§Ø±Ø§Ø¯Ù‡**: Ø¨Ø²Ø±Ú¯â€ŒØªØ±ÛŒÙ† Ú©Ø´Ù Ù†Ø³Ù„ Ù…Ø§ Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ Ø§Ù†Ø³Ø§Ù† Ø¨Ø§ ØªØºÛŒÛŒØ± Ù†Ú¯Ø±Ø´ Ø°Ù‡Ù†ÛŒâ€ŒØ§Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø²Ù†Ø¯Ú¯ÛŒâ€ŒØ§Ø´ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡Ø¯.",
        "ğŸš€ **ØªÙ„Ø§Ø´**: Ù…ÙˆÙÙ‚ÛŒØª ØªØµØ§Ø¯ÙÛŒ Ù†ÛŒØ³ØªØŒ Ø­Ø§ØµÙ„ Ù¾Ø´ØªÚ©Ø§Ø±ØŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒØŒ Ù…Ø·Ø§Ù„Ø¹Ù‡ØŒ Ù‚Ø±Ø¨Ø§Ù†ÛŒ Ú©Ø±Ø¯Ù† Ùˆæœ€é‡è¦çš„æ˜¯ Ø¹Ø´Ù‚ Ø¨Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯.",
        "ğŸŒŸ **Ø§Ù…ÛŒØ¯**: Ø¨Ù‡ØªØ±ÛŒÙ† Ø±Ø§Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ØŒ Ø³Ø§Ø®ØªÙ† Ø¢Ù† Ø§Ø³Øª.",
        "ğŸ¯ **ØªÙ…Ø±Ú©Ø²**: Ø±ÙˆÛŒ Ø§Ù‡Ø¯Ø§ÙØªØ§Ù† ØªÙ…Ø±Ú©Ø² Ú©Ù†ÛŒØ¯ØŒ Ù†Ù‡ Ù…ÙˆØ§Ù†Ø¹.",
        "ğŸ“š **Ø¹Ù„Ù…**: Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø±ÙˆÛŒ Ø¯Ø§Ù†Ø´ Ø¨Ù‡ØªØ±ÛŒÙ† Ø³ÙˆØ¯ Ø±Ø§ Ø¯Ø§Ø±Ø¯.",
        "â° **Ø²Ù…Ø§Ù†**: Ø²Ù…Ø§Ù† Ø·Ù„Ø§Ø³ØªØŒ Ø§Ù…Ø§ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯. ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ wisely ØµØ±Ù Ú©Ù†ÛŒØ¯.",
        "ğŸ’ **Ø§ØµØ§Ù„Øª**: Ù…Ø§Ù†Ù†Ø¯ Ø§Ù„Ù…Ø§Ø³ Ø¨Ø§Ø´ÛŒØ¯ - Ú©Ù…ÛŒØ§Ø¨ØŒ Ø¨Ø§Ø§Ø±Ø²Ø´ Ùˆ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø±Ø®Ø´Ù†Ø¯Ù‡.",
        "ğŸŒˆ **Ù¾Ø´ØªÚ©Ø§Ø±**: Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø± ØªØ§Ø±ÛŒÚ©ÛŒØŒ Ø±ÙˆØ´Ù†Ø§ÛŒÛŒ Ù…ÛŒâ€ŒØ¢ÛŒØ¯. Ù¾Ø³ Ù‡ÛŒÚ†â€ŒÚ¯Ø§Ù‡ Ø§Ù…ÛŒØ¯Øª Ø±Ø§ Ø§Ø² Ø¯Ø³Øª Ù†Ø¯Ù‡.",
        "ğŸ“ **Ù‡Ø¯Ù**: Ø¢Ù…ÙˆØ²Ø´ Ù‚Ø¯Ø±ØªÙ…Ù†Ø¯ØªØ±ÛŒÙ† Ø³Ù„Ø§Ø­ÛŒ Ø§Ø³Øª Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø¬Ù‡Ø§Ù† Ø§Ø² Ø¢Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
        "ğŸ”¥ **Ø§Ø´ØªÛŒØ§Ù‚**: Ø§Ú¯Ø± Ú†ÛŒØ²ÛŒ Ø±Ø§ Ø¨Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø§ÙÛŒ Ø¯ÙˆØ³Øª Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯ØŒ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ Ø¯Ø³Øª Ø¢ÙˆØ±Ø¯Ù†Ø´ ØªÙ…Ø§Ù… Ù‚ÙˆØ§ÙŠØª Ø±Ø§ Ø¨Ù‡ Ú©Ø§Ø± Ø®ÙˆØ§Ù‡ÛŒ Ú¯Ø±ÙØª."
    ]
    return random.choice(quotes)

def calculate_study_progress(total_study_minutes: int, target_minutes: int = 10000) -> Dict[str, Any]:
    """
    Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù‡Ø¯Ù (Û±Û°Û°Û°Û° Ø¯Ù‚ÛŒÙ‚Ù‡ = Ø­Ø¯ÙˆØ¯ Û±Û¶Û· Ø³Ø§Ø¹Øª)
    """
    if target_minutes <= 0:
        return {
            'percentage': 0,
            'remaining_minutes': 0,
            'remaining_hours': 0,
            'progress_bar': "â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘"
        }
    
    percentage = min(100, (total_study_minutes / target_minutes) * 100)
    remaining_minutes = max(0, target_minutes - total_study_minutes)
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª
    progress_length = 10
    filled_length = int(progress_length * percentage / 100)
    progress_bar = "â–ˆ" * filled_length + "â–‘" * (progress_length - filled_length)
    
    return {
        'percentage': round(percentage, 1),
        'remaining_minutes': remaining_minutes,
        'remaining_hours': round(remaining_minutes / 60, 1),
        'progress_bar': progress_bar
    }

def calculate_streak(study_days: List[str]) -> int:
    """
    Ù…Ø­Ø§Ø³Ø¨Ù‡ streak (ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡)
    """
    if not study_days:
        return 0
    
    # ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø¨Ù‡ datetime Ùˆ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
    dates = sorted([datetime.strptime(day, '%Y-%m-%d').date() for day in study_days])
    
    streak = 1
    current_date = dates[-1]
    
    for i in range(len(dates)-2, -1, -1):
        if (current_date - dates[i]).days == 1:
            streak += 1
            current_date = dates[i]
        else:
            break
    
    return streak
